---
layout: page
title: "Pool Replicates"
category: doc
date: 2020-11-05 15:25:33
use_math: true
order: 9
---
<!-- AMiGA is covered under the GPL-3 license -->
**Table of Contents**

* TOC
{:toc}

<br />

AMiGA can model individual growth curves to estimate growth parameters. It can also pool experimental and/or technical replicates to model mean growth behavior and estimate summary statistics for growth parameters, in particular mean, standard deviation, and confidence intervals.

<br/>

#### What is pooling?

In this example, I have in my working directory (`/Users/firasmidani/xperiment/`) multiple data files in the `data` sub-folder. As previously shown, you can analyze all growth curves separately without pooling. 

```bash
python $amiga/amiga.py fit \
        -i /Users/firasmidani/experiment/ \
        -o "split_merged"
        --merge-summary
```   

<br/>

Below, I however ask `AMiGA` to pool replicates based on all unique combinations of `Isolate`and `Substrate`. If I am analyzing the growth of 2 isolates on 96 substrates, I have 192 unique combinations. For each unique condition (`Isolate` x `Substrate`), `AMiGA` will find all replicate samples and model them jointly. To pool these replicates, you must pass the necessary meta-data to AMiGA. See [Preparing metadata](/amiga/doc/metadata.html). Here, let us assume that my meta-data already includes columns for `Isolate` and `Substrate`.

```bash
python $amiga/amiga.py fit \
        -i /Users/firasmidani/experiment/ \
        -o "pooled_analysis" \
        --pool-by "Isolate,Substrate"
```

<br/>

#### How to infer summary statistics for pooled replicates?

Below, the `--sample-posterior` argument asks AMiGA to infer summary statistics for the estimated growth parameters. If not called, `AMiGA` simply provides a single estimate of each growth parameter based on the mean latent function of the GP model. If called, `AMiGA` samples from the posterior distribution of the predicted curve (`n` times, where `n` is defined in the `libs/config.py` file), computes the growth parameter for each sampled curve, then returns the mean and the standard deviation of the mean of each growth parameter in the `summary` file.

```bash
python $amiga/amiga.py fit \
        -i /Users/firasmidani/experiment/ \
        -o "pooled_analysis" \
        --pool-by "Isolate,Substrate" \
        --sample-posterior 
```

<br/>

#### How to empirically estimate measurement noise?

Gaussian Process regression will model measurement noise as a single time-independent term ($$\sigma_{noise}$$). This noise term influences the standard deviation and thus confidence intervals of the predicted growth parameters. However, measurement noise tends to vary with time and is often smaller during lag and exponential phase and larger during stationary and death phases. The user has the option of empirically modelling the measurement noise. This measurement noise is computed as the variance across all replicates at each time point, which is then smoothed over time with a Gaussian filter. The user can opt for inferring summary statistics with empirically estimated measurement noise using the `--fix-noise` argument. While fitting growth with empirically estimated measurements fine-tunes confidence intervals, it is more prone to over-fitting and should be used with caution. 

```bash
python $amiga/amiga.py fit \
        -i /Users/firasmidani/experiment/ \
        -o "pooled_analysis" \
        --pool-by "Isolate,Substrate" \
        --sample-posterior --fix-noise
```


<br/>

Of course, you can further specify the analysis with additional command line arguments.

```bash
python $amiga/amiga.py fit
        -i /Users/firasmidani/experiment/
        -o "pooled_analysis" \
        --pool-by "Isolate,Substrate,PM" \
        --skip-first-n 1 -tss 1  \
        --save-gp-data --save-cleaned-data --save-mapping-data \
        --sample-posterior --fix-noise --verbose
```

<br />
#### Where are the linear estimates of AUC, Carrying Capacity, and Death?

Pooling combines the measurmeents across multiple replicates. These replictes likely have different starting Optical Density measurements. In order to estimate AUC, Carrying Capacity in linear units of OD or OD x time, `AMiGA` would need make assumptions about the starting OD value which could vary drsastically based on the experimental and measurement noise of your samples. Therefore, `AMiGA` will only provide estimates of AUC, Carrying Capacity, and Death based on log OD curve. See the section titled "[The log-based estimates of AUC, K, and Death are relative!](/amiga/doc/fitting.html)" for more details on how to interpret these estimates. 